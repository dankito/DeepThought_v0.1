<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<script src="ckeditor/ckeditor.js"></script>
	<script src="toolbar.js"></script>
	<script src="jquery-2.1.4.js"></script>
</head>

<body>
<div id="container" >
<textarea id="editor" name="editor" >

</textarea>
</div>

<script type="text/javascript">

	CKEDITOR.env.isCompatible = true;
	CKEDITOR.config.removePlugins = 'elementspath,resize';

	var editor = CKEDITOR.replace( 'editor', {
	   	top: 0,
	   	left: 0,
	   	width : '100%',
	   	height : '100%',
	   	allowedContent: true,

        on: {
			pluginsLoaded: function() {
			   customizeToolbar(editor);
			}
		}
	} );

	editor.on('loaded', function() {
		<!--editor.resize($(window).width(), $(window).height());-->

		if(typeof app !== 'undefined') {
			app.loaded();
		}

		<!--$(editor.editable).click( function(evt) {-->
			<!--if(typeof app !== 'undefined') {-->
				<!--app.elementClicked(evt.target);-->
			<!--}-->
		<!--});-->
	});

	editor.on('change', function(evt) {
		<!-- Notify Java code that Html text has changed -->
		if(typeof app !== 'undefined') {
			app.htmlChanged(editor.getData());
		}
	});

	editor.on('beforeCommandExec', function(evt) {
		if(typeof app !== 'undefined') {
			return app.beforeCommandExecution(evt.data.name); // when returning false command then won't be executed
		}
	});

	editor.on( 'doubleclick', function( evt ) {
		var element = evt.data.element;

		if ( element.is( 'table' ) )
			evt.data.dialog = 'tableProperties';
	} );

	$(window).resize( function() {
		<!-- This is curious, mostly it fits perfectly in window then, but sometimes it gets a margin -->
		editor.resize($(window).width() - 16, $(window).height() - 16);
	});

	<!-- handle Dialogs -->
	  <!--CKEDITOR.on('dialogDefinition', function(ev) {-->
        <!--// Take the dialog name and its definition from the event data-->
        <!--var dialogName = ev.data.name;-->
        <!--var dialogDefinition = ev.data.definition;-->

        <!--if (dialogName == 'image') {-->
           <!--dialogDefinition.onOk = function(e) {-->
              <!--var imageSrcUrl = e.sender.originalElement.$.src;-->
              <!--var imgHtml = CKEDITOR.dom.element.createFromHtml("<img src=" + imageSrcUrl + " alt='' align='right'/>");-->
              <!--CKEDITOR.instances.body.insertElement(imgHtml);-->
           <!--};-->
        <!--}-->
  <!--}-->

  	<!-- Trying to prevent that clicks on links are not executed (that means: not navigated to link's target), but doesn't work -->

	  <!--editor.on( 'contentDom', function() {-->
	  	<!--var isCTRL = false;-->

	  	<!--this.document.on('click', function(evt) {-->
					<!--alert('Clicked');-->
			<!--var element = CKEDITOR.plugins.link.getSelectedLink( editor ) || evt.data.element;-->
			<!--if (element!=undefined &&  element.is( 'a' ) ) {-->
				<!--if (evt.preventDefault) {-->
					<!--alert('calling prevent default');-->
					<!--evt.preventDefault();-->
				<!--}-->
				<!--else {-->
					<!--alert('Setting returnValue to false');-->
					<!--evt.returnValue = false;-->
					<!--return false;-->
				<!--}-->
			<!--}-->
		<!--}, null, null, 1);-->

		<!--editor.document.on( 'keyup', function(event) {-->
			<!--if(event.data.$.keyCode == 17) isCTRL=false;-->
		<!--});-->

		<!--editor.document.on( 'keydown', function(event) {-->
			<!--if(event.data.$.keyCode == 17) isCTRL=true;-->
		<!--});-->


		<!--&lt;!&ndash;var editable = editor.editable();&ndash;&gt;-->

		<!--&lt;!&ndash;var removeListener = editable.attachListener( editable, 'click', function(evt) {&ndash;&gt;-->
			<!--&lt;!&ndash;var isCTRL = false;&ndash;&gt;-->
			<!--&lt;!&ndash;var element = CKEDITOR.plugins.link.getSelectedLink( editor ) || evt.data.element;&ndash;&gt;-->
			<!--&lt;!&ndash;if (element!=undefined &&  element.is( 'a' ) ) {&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;if (evt.preventDefault) {&ndash;&gt;&ndash;&gt;-->
					<!--&lt;!&ndash;&lt;!&ndash;alert('calling prevent default');&ndash;&gt;&ndash;&gt;-->
					<!--&lt;!&ndash;&lt;!&ndash;evt.preventDefault();&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;}&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;else {&ndash;&gt;&ndash;&gt;-->
					<!--&lt;!&ndash;&lt;!&ndash;alert('Setting returnValue to false');&ndash;&gt;&ndash;&gt;-->
					<!--&lt;!&ndash;&lt;!&ndash;evt.returnValue = false;&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;}&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;alert('calling prevent default');&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;evt.preventDefault();&ndash;&gt;&ndash;&gt;-->

				<!--&lt;!&ndash;&lt;!&ndash;if(isCTRL)&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;{&ndash;&gt;&ndash;&gt;-->
					<!--&lt;!&ndash;&lt;!&ndash;window.open(element.$.href,'_blank');&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;&lt;!&ndash;}&ndash;&gt;&ndash;&gt;-->
			<!--&lt;!&ndash;}&ndash;&gt;-->

			<!--&lt;!&ndash;&lt;!&ndash; Notify Java code that an element has been clicked &ndash;&gt;&ndash;&gt;-->
			<!--&lt;!&ndash;if(typeof app !== 'undefined') {&ndash;&gt;-->
				<!--&lt;!&ndash;if(app.elementClicked(evt.data.getTarget().$.nodeName)) {&ndash;&gt;-->
					<!--&lt;!&ndash;&lt;!&ndash;evt.preventDefault(true);&ndash;&gt;&ndash;&gt;-->
				<!--&lt;!&ndash;}&ndash;&gt;-->
			<!--&lt;!&ndash;}&ndash;&gt;-->
		<!--&lt;!&ndash;});&ndash;&gt;-->

	    <!--&lt;!&ndash;editor.on( 'contentDomUnload', function() {&ndash;&gt;-->
		  <!--&lt;!&ndash;editable.removeAllListeners();&ndash;&gt;-->
	    <!--&lt;!&ndash;});&ndash;&gt;-->
	  <!--});-->

</script>

<script type="text/javascript">
        function callJava(){
        	if(typeof app !== 'undefined') {
				app.htmlChanged(editor.getData());
            }
        }
    </script>
</body>

</html> 
